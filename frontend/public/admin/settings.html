<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Settings - ISRS Admin</title>
  <link rel="icon" type="image/png" href="/images/favicon.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Marcellus&family=PT+Serif:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="stylesheet" href="/css/admin-layout.css">
  <link rel="stylesheet" href="/css/admin-unified.css">
  <!-- Tour System -->
  <link rel="stylesheet" href="/css/tour.css">
  <!-- Error Reporter - Logs frontend errors to backend/Render -->
  <script src="/js/errorReporter.js"></script>
</head>
<body class="admin-page">
  <div class="admin-content-padded" style="max-width: 900px; margin: 0 auto;">
    <!-- Page Header -->
    <div class="admin-page-header" style="background: transparent; border: none; padding-left: 0;">
      <h1>Settings</h1>
    </div>

    <!-- Account Settings -->
    <div class="admin-card admin-mb-lg">
      <div class="admin-card-header">
        <h2>Account Settings</h2>
      </div>
      <div class="admin-card-body" style="padding: 0;">
        <div class="setting-item">
          <div class="setting-info">
            <h4 class="admin-mb-0">Profile Information</h4>
            <p class="admin-text-muted admin-mb-0" style="font-size: var(--admin-text-sm);">Update your name, email, and contact information</p>
          </div>
          <div class="setting-action">
            <button class="admin-btn admin-btn-primary" onclick="alert('Coming soon!')">Edit Profile</button>
          </div>
        </div>

        <div class="setting-item">
          <div class="setting-info">
            <h4 class="admin-mb-0">Change Password</h4>
            <p class="admin-text-muted admin-mb-0" style="font-size: var(--admin-text-sm);">Update your password to keep your account secure</p>
          </div>
          <div class="setting-action">
            <button class="admin-btn admin-btn-primary" onclick="alert('Coming soon!')">Change Password</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Notification Settings -->
    <div class="admin-card admin-mb-lg">
      <div class="admin-card-header">
        <h2>Notifications</h2>
      </div>
      <div class="admin-card-body" style="padding: 0;">
        <div class="setting-item">
          <div class="setting-info">
            <h4 class="admin-mb-0">Email Notifications</h4>
            <p class="admin-text-muted admin-mb-0" style="font-size: var(--admin-text-sm);">Receive updates about new contacts, registrations, and board votes</p>
          </div>
          <div class="setting-action">
            <button class="admin-btn admin-btn-primary" onclick="alert('Coming soon!')">Configure</button>
          </div>
        </div>

        <div class="setting-item">
          <div class="setting-info">
            <h4 class="admin-mb-0">Daily Digest</h4>
            <p class="admin-text-muted admin-mb-0" style="font-size: var(--admin-text-sm);">Get a daily summary of system activity</p>
          </div>
          <div class="setting-action">
            <button class="admin-btn admin-btn-primary" onclick="alert('Coming soon!')">Configure</button>
          </div>
        </div>
      </div>
    </div>

    <!-- System Settings -->
    <div class="admin-card admin-mb-lg">
      <div class="admin-card-header">
        <h2>System</h2>
      </div>
      <div class="admin-card-body" style="padding: 0;">
        <div class="setting-item">
          <div class="setting-info">
            <h4 class="admin-mb-0">Export Data</h4>
            <p class="admin-text-muted admin-mb-0" style="font-size: var(--admin-text-sm);">Download a complete backup of all your data</p>
          </div>
          <div class="setting-action">
            <button class="admin-btn admin-btn-secondary" onclick="alert('Coming soon!')">Export All Data</button>
          </div>
        </div>

        <div class="setting-item">
          <div class="setting-info">
            <h4 class="admin-mb-0">API Access</h4>
            <p class="admin-text-muted admin-mb-0" style="font-size: var(--admin-text-sm);">Manage API keys and integrations</p>
          </div>
          <div class="setting-action">
            <button class="admin-btn admin-btn-secondary" onclick="alert('Coming soon!')">Manage API</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Email & AWS Configuration -->
    <div class="admin-card admin-mb-lg">
      <div class="admin-card-header">
        <h2>Email & AWS Configuration</h2>
        <span class="admin-badge admin-badge-warning" style="font-size: 0.75rem; margin-left: 0.5rem;">Super Admin Only</span>
      </div>
      <div class="admin-card-body">
        <div class="admin-alert admin-alert-warning admin-mb-lg">
          <strong>⚠️ Sensitive Information</strong>
          <p class="admin-mb-0" style="font-size: var(--admin-text-sm); margin-top: 0.5rem;">This section contains sensitive AWS credentials. Do not share these with unauthorized personnel.</p>
        </div>

        <!-- AWS SES Credentials -->
        <div style="margin-bottom: var(--admin-space-xl);">
          <h3 style="font-size: 1.1rem; margin-bottom: var(--admin-space-md); color: var(--admin-gray-900);">AWS SES Credentials</h3>
          <div style="background: var(--admin-gray-50); border: 1px solid var(--admin-gray-200); border-radius: 6px; padding: var(--admin-space-lg); font-family: 'Courier New', monospace; font-size: 0.85rem;">
            <div style="margin-bottom: var(--admin-space-md);">
              <strong>Access Key ID:</strong><br>
              <code style="background: white; padding: 0.25rem 0.5rem; border-radius: 4px; display: inline-block; margin-top: 0.25rem;">STORED_IN_ENV</code>
              <button onclick="alert('AWS credentials are stored in environment variables for security')" class="admin-btn admin-btn-sm" style="margin-left: 0.5rem; padding: 0.25rem 0.5rem;">ℹ Info</button>
            </div>
            <div style="margin-bottom: var(--admin-space-md);">
              <strong>Secret Access Key:</strong><br>
              <code style="background: white; padding: 0.25rem 0.5rem; border-radius: 4px; display: inline-block; margin-top: 0.25rem;">••••••••••••••••••••</code>
              <button onclick="alert('AWS credentials are stored in environment variables for security')" class="admin-btn admin-btn-sm" style="margin-left: 0.5rem; padding: 0.25rem: 0.5rem;">ℹ Info</button>
            </div>
            <div style="margin-bottom: var(--admin-space-md);">
              <strong>AWS Region:</strong> <code>us-east-1</code>
            </div>
            <div style="margin-bottom: var(--admin-space-md);">
              <strong>From Email:</strong> <code>noreply@shellfish-society.org</code>
            </div>
            <div style="margin-bottom: 0;">
              <strong>From Name:</strong> <code>ISRS</code>
            </div>
          </div>
          <p style="font-size: var(--admin-text-sm); color: var(--admin-gray-600); margin-top: var(--admin-space-sm);">
            <strong>Description:</strong> ISRS Email Campaigns - SES Access Key for Render Backend<br>
            <strong>Permissions:</strong> AmazonSESFullAccess
          </p>
        </div>

        <!-- Production Access Status -->
        <div style="margin-bottom: var(--admin-space-xl);">
          <h3 style="font-size: 1.1rem; margin-bottom: var(--admin-space-md); color: var(--admin-gray-900);">Production Access Status</h3>
          <div class="admin-alert admin-alert-success">
            <strong>✓ Production Mode Active</strong>
            <p class="admin-mb-0" style="font-size: var(--admin-text-sm); margin-top: 0.5rem;">
              Your AWS SES account has production access enabled. You can send emails to any recipient.<br>
              <strong>Daily Limit:</strong> 50,000 emails per 24-hour period<br>
              <strong>Send Rate:</strong> 14 emails per second
            </p>
          </div>
          <a href="https://us-east-1.console.aws.amazon.com/ses/home?region=us-east-1#/account" target="_blank" rel="noopener noreferrer" class="admin-btn admin-btn-secondary" style="margin-top: var(--admin-space-md);">
            View AWS SES Dashboard →
          </a>
        </div>

        <!-- DMARC Configuration -->
        <div style="margin-bottom: 0;">
          <h3 style="font-size: 1.1rem; margin-bottom: var(--admin-space-md); color: var(--admin-gray-900);">DMARC Configuration Needed</h3>
          <div class="admin-alert admin-alert-warning">
            <strong>⚠️ Action Required</strong>
            <p style="font-size: var(--admin-text-sm); margin-top: 0.5rem; margin-bottom: var(--admin-space-md);">
              AWS recommends setting up DMARC records for <code>shellfish-society.org</code> to improve email deliverability and prevent spoofing.
            </p>
            <details style="margin-top: var(--admin-space-md);">
              <summary style="cursor: pointer; font-weight: 600; margin-bottom: var(--admin-space-sm);">View DMARC Setup Instructions</summary>
              <div style="padding-left: var(--admin-space-md); margin-top: var(--admin-space-md);">
                <p style="font-size: var(--admin-text-sm); margin-bottom: var(--admin-space-sm);"><strong>1. Add SPF Record:</strong></p>
                <code style="background: white; padding: 0.5rem; border-radius: 4px; display: block; margin-bottom: var(--admin-space-md); font-size: 0.8rem;">
                  v=spf1 include:amazonses.com ~all
                </code>

                <p style="font-size: var(--admin-text-sm); margin-bottom: var(--admin-space-sm);"><strong>2. Add DMARC Record:</strong></p>
                <code style="background: white; padding: 0.5rem; border-radius: 4px; display: block; margin-bottom: var(--admin-space-md); font-size: 0.8rem;">
                  v=DMARC1; p=quarantine; rua=mailto:dmarc-reports@shellfish-society.org
                </code>

                <p style="font-size: var(--admin-text-sm); margin-bottom: var(--admin-space-sm);"><strong>3. Add DKIM Records:</strong></p>
                <p style="font-size: var(--admin-text-sm); color: var(--admin-gray-600);">
                  DKIM records are specific to AWS SES. Generate them in the <a href="https://us-east-1.console.aws.amazon.com/ses/home?region=us-east-1#/verified-identities/shellfish-society.org" target="_blank" rel="noopener noreferrer">AWS SES Console</a> for shellfish-society.org.
                </p>
              </div>
            </details>
          </div>
          <a href="https://us-east-1.console.aws.amazon.com/ses/home?region=us-east-1#/verified-identities" target="_blank" rel="noopener noreferrer" class="admin-btn admin-btn-secondary" style="margin-top: var(--admin-space-md);">
            Manage Verified Identities →
          </a>
        </div>
      </div>
    </div>

    <!-- Help & Support -->
    <div class="admin-card admin-mb-lg">
      <div class="admin-card-header">
        <h2>Help & Support</h2>
      </div>
      <div class="admin-card-body" style="padding: 0;">
        <div class="setting-item">
          <div class="setting-info">
            <h4 class="admin-mb-0">Admin Portal Tour</h4>
            <p class="admin-text-muted admin-mb-0" style="font-size: var(--admin-text-sm);">Replay the guided walkthrough of admin features</p>
          </div>
          <div class="setting-action">
            <button class="admin-btn admin-btn-secondary" onclick="restartAdminTour()">
              <span style="margin-right: 0.25rem;">?</span> Restart Tour
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Info Box -->
    <div class="admin-alert admin-alert-info">
      <div>
        <h4 class="admin-mb-sm" style="color: var(--admin-info-text);">Need Help?</h4>
        <p class="admin-mb-0" style="font-size: var(--admin-text-sm);">Contact the ISRS system administrator if you need assistance with any settings. Use the Feedback button in the bottom-right to report issues or request features.</p>
      </div>
    </div>
  </div>

  <style>
    /* Settings-specific styles using CSS variables */
    .setting-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--admin-space-lg) var(--admin-space-xl);
      border-bottom: 1px solid var(--admin-gray-200);
    }
    .setting-item:last-child {
      border-bottom: none;
    }
    .setting-info {
      flex: 1;
    }
    .setting-action {
      margin-left: var(--admin-space-lg);
    }
  </style>

  <!-- Email Utils -->
  <script src="/js/email-utils.js"></script>

  <!-- Admin Layout -->
  <script src="/js/admin-layout.js"></script>
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      // Check auth
      const sessionToken = localStorage.getItem('isrs_session_token');
      if (!sessionToken) {
        window.location.href = '/admin/';
        return;
      }

      loadAdminLayout('settings');
    });
  </script>

  <!-- Feedback Widget -->
  <script src="/js/feedback-widget.js"></script>
  <script>
    initFeedbackWidget({ isAdminPortal: true });
  </script>

  <!-- Tour System -->
  <script src="/js/tour-manager.js"></script>
  <script src="/js/tour-definitions.js"></script>
  <script>
    // Restart admin portal tour
    function restartAdminTour() {
      if (window.TourManager) {
        TourManager.reset('admin-portal');
        // Redirect to admin dashboard where tour runs
        window.location.href = '/admin/index.html';
      } else {
        alert('Tour system not available. Please refresh the page.');
      }
    }

    // Copy to clipboard utility
    function copyToClipboard(text) {
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).then(() => {
          // Show success message
          const btn = event.target;
          const originalText = btn.textContent;
          btn.textContent = 'Copied!';
          btn.style.background = 'var(--admin-success)';
          btn.style.color = 'white';
          setTimeout(() => {
            btn.textContent = originalText;
            btn.style.background = '';
            btn.style.color = '';
          }, 2000);
        }).catch(err => {
          alert('Failed to copy: ' + err);
        });
      } else {
        // Fallback for older browsers
        const textarea = document.createElement('textarea');
        textarea.value = text;
        textarea.style.position = 'fixed';
        textarea.style.opacity = '0';
        document.body.appendChild(textarea);
        textarea.select();
        try {
          document.execCommand('copy');
          const btn = event.target;
          const originalText = btn.textContent;
          btn.textContent = 'Copied!';
          btn.style.background = 'var(--admin-success)';
          btn.style.color = 'white';
          setTimeout(() => {
            btn.textContent = originalText;
            btn.style.background = '';
            btn.style.color = '';
          }, 2000);
        } catch (err) {
          alert('Failed to copy: ' + err);
        }
        document.body.removeChild(textarea);
      }
    }
  </script>
</body>
</html>
